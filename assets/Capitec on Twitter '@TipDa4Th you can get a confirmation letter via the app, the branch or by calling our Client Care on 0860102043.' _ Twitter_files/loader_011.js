(window.webpackJsonp=window.webpackJsonp||[]).push([[151],{"3GUV":function(e,t,s){"use strict";var r=s("ERkP"),i=s("rHpw"),n=s("MWbm");class o extends r.Component{shouldComponentUpdate(){return!1}render(){return r.createElement(n.a,{style:a.root})}}const a=i.a.create(e=>({root:{height:5*parseInt(e.lineHeight,10)+"rem"}}));t.a=o},"5UID":function(e,t,s){"use strict";var r=s("ERkP"),i=s("3XMw"),n=s.n(i),o=s("rHpw"),a=s("+/1j"),c=s("MWbm");const l=n.a.e5b0063d;let h=0;class d extends r.Component{constructor(){super(),this._listDomId="accessible-list-"+h,h+=1}render(){const{children:e,title:t}=this.props,s=l({title:t});return r.createElement(c.a,{accessibilityRole:"region","aria-labelledby":this._listDomId},r.createElement(a.a,{accessibilityRole:"heading","aria-level":1,nativeID:this._listDomId,style:o.a.visuallyHidden},t),r.createElement(c.a,{accessibilityLabel:s},e))}}t.a=d},JsJV:function(e,t,s){"use strict";var r=s("6/RC"),i=s("tI3i"),n=s.n(i),o=r.canUseDOM?window.location.href:"",a={addEventListener:function(){},removeEventListener:function(){},canOpenURL:function(){return Promise.resolve(!0)},getInitialURL:function(){return Promise.resolve(o)},openURL:function(e){try{return c(e),Promise.resolve()}catch(e){return Promise.reject(e)}},_validateURL:function(e){n()("string"==typeof e,"Invalid URL: should be a string. Was: "+e),n()(e,"Invalid URL: cannot be empty")}},c=function(e){r.canUseDOM&&(window.location=new URL(e,window.location).toString())};t.a=a},VeNJ:function(e,t,s){"use strict";s.r(t),s.d(t,"TimelineRenderer",(function(){return oe}));s("IAdD"),s("kYxP");var r=s("KEM+"),i=s.n(r),n=s("n+Zb"),o=s("ERkP"),a=s("5UID"),c=s("6/RC"),l=s("1YZw"),h=s("rxPX"),d=Object(h.a)().propsFromActions(()=>({addToast:l.b})).withAnalytics(),p=s("KNCp"),m=s("lUZE");var u=Object.freeze({Icon:"Icon",IconSmall:"IconSmall",FullWidth:"FullWidth"}),b=s("caTy"),y=s("TnY3"),_=s("TIdA"),g=s("A91F"),v=s("feu+"),f=s("JsJV"),C=s("MWbm"),E=s("oQhu"),I=s("fs1G"),w=s("rcen");class T extends o.PureComponent{constructor(...e){super(...e),i()(this,"_getGraphicProps",Object(E.a)((e,t)=>{const s=e?({style:t})=>o.createElement(C.a,{style:t},o.createElement(_.a,{accessibilityLabel:"",aspectMode:g.a.exact(e.width/e.height),image:e})):m.a;let r="illustration";return e&&t!==u.IconSmall?t===u.FullWidth&&(r="illustrationFullWidth"):r="icon",{graphic:s,graphicDisplayMode:r}})),i()(this,"_scribeAction",(e,t)=>{const{analytics:s}=this.props,{action:r,component:i,element:n}=t||{};s.scribe({action:r||e,component:i||"cover",element:n})}),i()(this,"_handleDismiss",()=>{const{dismissInfo:e,processCallback:t}=this.props,{callbacks:s}=e||{};s&&s.forEach(e=>{t(e)}),e&&(this._scribeAction("dismiss"),this.props.onClose())}),i()(this,"_handlePrimaryCtaClick",()=>{this._handleCtaClick(this.props.primaryCta,"primary_cta")}),i()(this,"_handleSecondaryCtaClick",()=>{this.props.secondaryCta&&this._handleCtaClick(this.props.secondaryCta,"secondary_cta")}),i()(this,"_handleCtaClick",({ctaBehavior:e,callbacks:t,clientEventInfo:s},r)=>{const{addToast:i,processCallback:n,history:o}=this.props;if(this.props.onClose(),this._scribeAction("click",Object.assign({element:r},s)),e.dismiss){const{dismiss:t}=e;t&&t.feedbackMessage&&i({text:t.feedbackMessage.text})}if(e.navigate){const{navigate:t}=e,s=t&&Object(b.b)(t.url);s&&(s.external?f.a.openURL(s.pathname):o.push(s.pathname))}t&&t.forEach(e=>n(e))})}componentDidMount(){this.props.onImpression&&this.props.onImpression()}render(){const{image:e,imageDisplayType:t,primaryText:s,primaryCta:r,secondaryText:i,secondaryCta:n,details:a,displayType:c,type:l,dismissInfo:h}=this.props,d=o.createElement(w.b,{entities:s.entities,text:s.text}),m=i?o.createElement(w.b,{entities:i.entities,text:i.text}):null;if(l===p.a.Full){const l=a?o.createElement(w.b,{entities:a.entities,text:a.text}):null,{graphic:p,graphicDisplayMode:u}=this._getGraphicProps(e,t);return o.createElement(v.a,{actionLabel:r.text,footer:l,footerAlign:a&&a.alignment===w.a.Center?"center":"left",graphic:p,graphicDisplayMode:u,headline:d,headlineAlign:s.alignment===w.a.Natural?"left":"center",isFullHeightOnMobile:!h&&"CenterCover"!==c,onAction:this._handlePrimaryCtaClick,onClose:this._handleDismiss,onTertiaryAction:this._handleSecondaryCtaClick,subtext:m,subtextAlign:i&&i.alignment===w.a.Natural?"left":"center",tertiaryActionLabel:n&&n.text,withCloseButton:!!h})}return o.createElement(v.a,{actionLabel:r.text,graphicDisplayMode:"none",headline:d,headlineAlign:s.alignment===w.a.Center?"center":"left",onAction:this._handlePrimaryCtaClick,onClose:I.a,onSecondaryAction:this._handleSecondaryCtaClick,secondaryActionLabel:n&&n.text,subtext:m,subtextAlign:i&&i.alignment===w.a.Center?"center":"left",withCloseButton:!1})}}i()(T,"defaultProps",{imageDisplayType:u.Icon});var S=Object(y.a)(d(T));const R={component:"cover",action:"impression"};var x=({activeCover:e,clearActiveCover:t,processCallback:s,scribeAction:r,scribeNamespace:i})=>{const n=((e,t)=>{let s=Object.assign({},e,R);return t&&(s=Object.assign({},s,{component:t.component||s.component,element:t.element||s.element,action:t.action||s.action})),s})(i,e.clientEventInfo),a=()=>{const{cover:{impressionCallbacks:t}}=e;t&&t.forEach(e=>s(e)),r(n)};return"full"===e.type?(c=e.cover,o.createElement(S,{details:c.details||void 0,dismissInfo:c.dismissInfo,displayType:c.displayType,image:c.image,imageDisplayType:c.imageDisplayType||void 0,onClose:t,onImpression:a,primaryCta:c.primaryCoverCta,primaryText:c.primaryText,processCallback:s,secondaryCta:c.secondaryCoverCta,secondaryText:c.secondaryText,type:"full"})):"half"===e.type?function(e){const r="CenterCover"===e.displayType?"full":"half";return o.createElement(S,{displayType:e.displayType,image:e.coverImage?e.coverImage.image:void 0,imageDisplayType:e.coverImage?e.coverImage.imageDisplayType:void 0,onClose:t,onImpression:a,primaryCta:e.primaryCoverCta,primaryText:e.primaryText,processCallback:s,secondaryCta:e.secondaryCoverCta,secondaryText:e.secondaryText,type:r})}(e.cover):null;var c},A=s("8UdT"),L=s("MDbM"),k=(s("C1yv"),s("Qyxo"));class D{constructor(){this._lingerScribed={},this._appearance={}}processPositioningUpdate(e,t,s=Date.now()){const r=N(e,t);return this._lingerTransition(r,s)}flushLingerEvents(e=Date.now()){return this._detectScribeLingerEvents(this._appearance,{},e)}_lingerTransition(e,t){const s=this._appearance;return this._appearance=e.reduce((e,r)=>(e[r]=s[r]||{start:t,lingered:!1},e),{}),{allLingerEvents:this._detectAllLingerEvents(s,t),scribeLingerEvents:this._detectScribeLingerEvents(s,this._appearance,t)}}_detectAllLingerEvents(e,t){return Object.keys(e).reduce((s,r)=>{const{start:i,lingered:n}=e[r];return!n&&t-i>=500&&(s.push(r),this._appearance[r]&&(this._appearance[r]=Object.assign({},this._appearance[r],{lingered:!0}))),s},[])}_detectScribeLingerEvents(e,t,s){return Object.keys(e).reduce((r,i)=>{const{start:n}=e[i];return!t[i]&&!this._lingerScribed[i]&&s-n>=500&&(this._lingerScribed[i]=!0,r.push({id:i,start:n,end:s})),r},[])}}const N=(e,t)=>Object(k.a)(e,({id:e,rectangle:s})=>O(s,t)>=.5*s.getHeight()?e:void 0),O=(e,t)=>Math.max(0,Math.min(e.getBottom(),t.getBottom())-Math.max(e.getTop(),t.getTop()));var P=s("OrGc"),j=s("hACr"),U=s("VPAj"),M=s("3GUV"),B=s("v//M"),F=s("rHpw");const W=Object(U.a)(o.createElement(M.a,null)),H=({bottomFetchStatus:e,onBottomRetry:t})=>o.createElement(C.a,{style:G.footer},o.createElement(B.a,{fetchStatus:e,onRequestRetry:t,render:W})),G=F.a.create(e=>({footer:{height:`calc(5 * ${e.lineHeight}rem)`}}));var K=o.memo(H),V=s("xjVt"),J=s("EUHl"),z=s("aWzz"),q=s("IG4P"),Z=s("iBK2"),Y=s("b1wW");s("rxtR");const Q=Object.freeze({ON_LINGER:"onLinger"});var X=s("aITJ"),$=s("cFgU"),ee=s("iChn"),te=s("+d3d");const se=e=>e.entryId,re=e=>e.sortIndex;const ie=new Map;let ne;class oe extends o.PureComponent{constructor(e){var t;super(e),i()(this,"_adjustFocusBy",e=>{this._shouldPreventKeyboardShortcuts()||this._scroller&&this._scroller.adjustFocusBy(e)}),i()(this,"_focusNext",()=>this._adjustFocusBy(1)),i()(this,"_focusPrevious",()=>this._adjustFocusBy(-1)),i()(this,"_renderLoadBottom",()=>{const{bottomFetchStatus:e,onBottomRetry:t}=this.props;return o.createElement(K,{bottomFetchStatus:e,onBottomRetry:t})}),i()(this,"_refreshControlWrapper",e=>{const{canRefresh:t,refreshControl:s,topFetchStatus:r,onRefresh:i}=this.props;return s?o.createElement(s,{canRefresh:t,isRefreshing:r===L.a.LOADING,onRefresh:i},e):e}),i()(this,"_getCellRenderer",Object(E.a)((e,t)=>{let s;const r={module:t,renderEntry:e=>s(e)};return s=(t,s)=>{const i=e.getHandler(t);return i&&i.render?i.render(t,r,s):null},s})),i()(this,"_getInitialFocusedEntry",Object(E.a)((e,t)=>t&&e.find(t))),i()(this,"_createEntryIndex",Object(E.a)(e=>Object(ee.a)(e,e=>e.entryId))),i()(this,"_handleBeforeWindowUnload",()=>{this._flushLingerScribes()}),i()(this,"scrollToTop",e=>{this._scroller&&this._scroller.scrollToTop(e)}),i()(this,"_shouldPreventKeyboardShortcuts",()=>{const{isModal:e,withKeyboardShortcuts:t}=this.props;return ne&&!e||!t}),i()(this,"_handleRefreshKeyboardShortcut",Object(te.a)(()=>{this._shouldPreventKeyboardShortcuts()||this.refreshOrGoTop(!0)},1e3)),i()(this,"_handleAtBottom",this._proximityHandler(()=>{this.props.onAtBottom&&this.props.onAtBottom()})),i()(this,"_handleNearBottom",this._proximityHandler(()=>{this.props.onNearBottom()})),i()(this,"_handleNearTop",this._proximityHandler(()=>{const{onNearTop:e}=this.props;e()})),i()(this,"_handleAtTop",this._proximityHandler(()=>{this.props.removeAlert&&this.props.removeAlert(),this.props.onAtTop&&this.props.onAtTop()})),i()(this,"_handleItemsRendered",this._proximityHandler(({viewport:e,positions:t})=>{const s=this._impressionTracker.processPositioningUpdate(t,e);this._scribeLingerEvents(s.scribeLingerEvents),this._handleOnLingerEvents(s.allLingerEvents)})),i()(this,"_handleOnLingerEvents",e=>{const{applyReactionInstructions:t}=this.props,s=this._getEntryIndex();e.forEach(e=>{const r=s[e];r&&t({entry:r,triggerName:Q.ON_LINGER})})}),i()(this,"_handlePositionRestored",()=>{this._positionedRestored=!0}),i()(this,"_scheduleNewEntriesScribing",(t=e=>{const{richScribeAction:t,scribeNamespace:s}=this.props,r=this._buildStreamScribeData(e);r.length>0&&t(Object.assign({},s,{component:"stream",action:"results"}),{items:r})},c.canUseDOM&&window.requestIdleCallback?e=>{const s=window.requestIdleCallback(()=>t(e));return()=>window.cancelIdleCallback(s)}:c.canUseDOM&&window.requestAnimationFrame?e=>{const s=window.requestAnimationFrame(()=>t(e));return()=>window.cancelAnimationFrame(s)}:()=>I.a)),i()(this,"_setScroller",e=>{this._scroller=e}),this._impressionTracker=new D,this._streamScribeCancelCallbacks=[]}UNSAFE_componentWillReceiveProps(e){this.props.timelineId!==e.timelineId&&(this._flushLingerScribes(),this._impressionTracker=new D)}componentDidMount(){const{isModal:e,onRef:t}=this.props;this._initialize(),window.addEventListener("beforelogout",this._handleBeforeWindowUnload),window.addEventListener("beforeunload",this._handleBeforeWindowUnload),t&&t(this),e&&(ne=!0)}componentWillUnmount(){const{isModal:e,onRef:t}=this.props;this._flushLingerScribes(),this._cancelStreamScribeCallbacks(),window.removeEventListener("beforelogout",this._handleBeforeWindowUnload),window.removeEventListener("beforeunload",this._handleBeforeWindowUnload),t&&t(void 0),e&&(ne=!1)}componentDidUpdate(e){const{entries:t,handlerRegistry:s,timelineId:r,onRef:i}=this.props;r!==e.timelineId?this._initialize():t===e.entries&&s===e.handlerRegistry||this._scribeNewEntries(t),i&&i!==e.onRef&&i(this)}render(){const{anchoring:e,entries:t,handlerRegistry:s,showFooter:r,header:i,isInitialFocusEntry:c,nearStartProximityRatio:l,renderEmptyState:h,scrollerDisplayType:d,timelineId:p,title:m,module:u}=this.props,b=this.props.scroller,y=this._getInitialFocusedEntry(t,c);return this._refreshControlWrapper(this._shouldRenderEmptyState(t)?h():o.createElement(a.a,{title:m},this._renderActiveCover(),this._renderPill(),o.createElement(j.a,{handlers:{[P.d.loadNewTweets]:this._handleRefreshKeyboardShortcut,[P.d.nextItem]:this._focusNext,[P.d.previousItem]:this._focusPrevious}},o.createElement(b,{anchoring:e,assumedItemHeight:X.a.isDesktopOS()?100:void 0,cacheKey:p,footer:r&&this._renderLoadBottom(),header:i,identityFunction:se,initialAnchor:y&&n.b(se(y)),items:t,nearStartProximityRatio:l,onAtEnd:this._handleAtBottom,onAtStart:this._handleAtTop,onItemsRendered:this._handleItemsRendered,onNearEnd:this._handleNearBottom,onNearStart:this._handleNearTop,onPositionRestored:this._handlePositionRestored,ref:this._setScroller,renderer:this._getCellRenderer(s,u),scrollerDisplayType:d,sortIndexFunction:re}))))}_renderPill(){const{alert:e,removeAlert:t,topUnseenCount:s,newTweetsPillMode:r,scribeNamespace:i,timelineId:n}=this.props;return r?r===J.a.URT?o.createElement(V.a.Configure,{alert:e,removeAlert:t,scribeNamespace:i,timelineId:n}):r===J.a.CLIENT&&s&&s>0?o.createElement(V.a.Configure,{removeAlert:t,scribeNamespace:i,timelineId:n,unreadCount:s}):void 0:null}_renderActiveCover(){const{activeCover:e,clearActiveCover:t,processCallback:s,scribeAction:r,scribeNamespace:i}=this.props,n=e&&e.cover;return e&&n?o.createElement(x,{activeCover:e,clearActiveCover:t,processCallback:s,scribeAction:r,scribeNamespace:i}):null}_shouldRenderEmptyState(e){const{activeCover:t,initialFetchStatus:s}=this.props,r=s===L.a.LOADED,i=0===e.length;return r&&i&&!t}_getEntryIndex(){return this._createEntryIndex(this.props.entries)}_initialize(){this._scribeNewEntries(this.props.entries)}_flushLingerScribes(){this._scribeLingerEvents(this._impressionTracker.flushLingerEvents())}refreshOrGoTop(e){this._scroller&&!this._scroller.isAtTop()?this.scrollToTop(e):this.props.onRefresh()}_proximityHandler(e){return t=>{this._positionedRestored&&e(t)}}_scribeNewEntries(e){const t=this._scheduleNewEntriesScribing(e);for(this._streamScribeCancelCallbacks.push(t);this._streamScribeCancelCallbacks.length>=20;)this._streamScribeCancelCallbacks.shift()}_buildStreamScribeData(e){const{scribeCache:t,timelineId:s,handlerRegistry:r}=this.props;let i=null;if(!t.has(s)){const e=new Set;t.set(s,e)}const n=t.get(s);return n?e.reduce((e,t,s)=>{const{entryId:o}=t;let a=!1;if(t.content&&t.content.promotedMetadata&&(a=t.content.promotedMetadata),!n.has(o)&&!r.getNeedsLoad(t)){n.add(o);const s=this._getScribeDataItem(r,t);s&&(a&&null!==i&&(s.tweet_count=i),e.push(s))}return a?i=0:null!==i&&-1===t.type.indexOf("ui_")&&(i+=1),e},[]):[]}_storeSeenIds(e){const{seenIds:t,seenIdsLatest:s,timelineId:r}=this.props;"home"===r&&t?t.addNewTweets(e):"home-latest"===r&&s&&s.addNewTweets(e)}_scribeLingerEvents(e){if(0===e.length)return;const{handlerRegistry:t}=this.props,s=this._getEntryIndex(),r=[],i=[];if(e.forEach(({id:e,start:n,end:o})=>{const a=s[e];if(a){const e=this._getScribeDataItem(t,a);if(e){const t={visibility_start:n,visibility_end:o};r.push(Object.assign({},e,{impression_details:t}))}a.type===A.b.Tweet&&i.push(a.content.id)}}),r.length>0){const{richScribeAction:e,scribeNamespace:t}=this.props;e(Object.assign({},t,{component:"stream",element:"linger",action:"results"}),{items:r})}i.length>0&&this._storeSeenIds(i)}_getScribeDataItem(e,t){const s=e.getHandler(t);if(s)return s.getScribeDataItem(t)}_cancelStreamScribeCallbacks(){this._streamScribeCancelCallbacks.forEach(e=>e())}}i()(oe,"contextTypes",{viewport:z.object}),i()(oe,"defaultProps",{showFooter:!0,onBottomRetry:I.a,onNearBottom:I.a,onNearTop:I.a,onRefresh:I.a,refreshControl:q.a,scribeCache:ie,scroller:Z.b,scrollerDisplayType:Y.a.Vertical,seenIds:Object($.b)(),seenIdsLatest:Object($.a)(),withKeyboardShortcuts:!0});t.default=oe},"n+Zb":function(e,t,s){"use strict";s.d(t,"b",(function(){return r})),s.d(t,"a",(function(){return i}));const r=e=>({id:e,distanceToViewportTop:0}),i=e=>({id:e,distanceToViewportBottom:0})}}]);
//# sourceMappingURL=https://ton.twitter.com/responsive-web-internal/sourcemaps/client-web/loader.TimelineRenderer.48b4df35.js.map